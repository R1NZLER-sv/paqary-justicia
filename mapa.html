<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Paqary Justicia - Mapa de Jueces de Paz</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: "Inter", system-ui, sans-serif;

      /* Fondo crema editorial */
      background:
        linear-gradient(135deg, rgba(234,219,200,0.5), rgba(247,239,230,0.9)),
        linear-gradient(180deg, #f7efe6, #eadbc8);
      background-blend-mode: multiply;

      color: #4a2e1f;
    }

    header {
      background-color: #111827;
      color: #f9fafb;
      text-align: center;
      padding: 12px 16px;
      font-weight: 700;
      letter-spacing: 1px;
      font-size: 1.05rem;
    }

    /* Contenedor principal: ocupa casi toda la pantalla */
    #container {
      display: flex;
      height: calc(100vh - 60px); /* 60px aprox. del header */
    }

    /* Panel izquierdo */
    #sidebar {
      width: 320px;
      max-width: 100%;
      background: rgba(247,239,230,0.95);
      border-right: 1px solid #d7c8b4;
      padding: 16px 18px;
      overflow-y: auto;
    }

    #sidebar h2 {
      font-size: 1.15rem;
      margin-bottom: 6px;
      color: #4a2e1f;
    }

    #sidebar p {
      font-size: 0.95rem;
      margin-bottom: 6px;
      color: #6b4a32;
    }

    .field-label {
      font-weight: 600;
      color: #4a2e1f;
    }

    .zone-pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e6d2b7;
      margin-top: 6px;
      color: #4a2e1f;
      font-size: 0.8rem;
    }

    /* Mapa a la derecha */
    #map {
      flex: 1;
      height: 100%;
    }

    /* Responsive */
    @media (max-width: 768px) {
      #container {
        flex-direction: column;
        height: auto;
        min-height: 100vh;
      }

      #sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #d7c8b4;
        max-height: 40vh;
      }

      #map {
        height: 60vh;
      }
    }
  </style>
</head>

<body>

  <header>Paqary Justicia – Mapa de Jueces de Paz</header>

  <div id="container">

    <!-- PANEL IZQUIERDO -->
    <aside id="sidebar">
      <h2>Selecciona una zona en el mapa</h2>
      <p>Haz clic sobre un área coloreada para ver los datos del juez de paz.</p>
      <div id="zone-details"></div>
    </aside>

    <!-- MAPA -->
    <div id="map"></div>

  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // ======================================================
    // GEOJSON – ZONAS (por ahora: CHARACATO y CHIGUATA)
    // ======================================================

    const zonasGeoJson = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": {
            "id_zona": 1,
            "zona": "CHARACATO",
            "juez_de_paz": "DEIVY HERRERA TORRES",
            "direccion": "Calle Socabaya N° 100, Plaza Principal de Characato",
            "telefono": "972960129 / 958798821",
            "horario": "Martes y viernes de 10:00 a 13:00 horas",
            "correo": "deivyherrera19@gmail.com",
            "mapsUrl": "https://maps.app.goo.gl/Erg1uZrfSop2W2yo6",
            "markerLat": -16.4728798,
            "markerLng": -71.4829052
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [-71.491737, -16.461658],
                [-71.484529, -16.464705],
                [-71.481697, -16.465694],
                [-71.476115, -16.467168],
                [-71.470280, -16.469062],
                [-71.463243, -16.470544],
                [-71.458780, -16.470709],
                [-71.455863, -16.471532],
                [-71.460411, -16.475979],
                [-71.457150, -16.481662],
                [-71.457922, -16.482979],
                [-71.466675, -16.481826],
                [-71.470709, -16.485450],
                [-71.476544, -16.485697],
                [-71.485212, -16.485038],
                [-71.490103, -16.485285],
                [-71.491905, -16.487261],
                [-71.498084, -16.487591],
                [-71.502889, -16.488497],
                [-71.506322, -16.488003],
                [-71.502460, -16.479356],
                [-71.502117, -16.473839],
                [-71.499028, -16.468403],
                [-71.496024, -16.463956],
                [-71.491737, -16.461658]
              ]
            ]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "id_zona": 2,
            "zona": "CHIGUATA",
            "juez_de_paz": "No registrado",
            "direccion": "Chiguata 04200, Arequipa",
            "telefono": "No registrado",
            "horario": "No registrado",
            "correo": "No registrado",
            "mapsUrl": "https://maps.app.goo.gl/ec9MKsdRiihD4qbo8",
            "markerLat": -16.402775,
            "markerLng": -71.392962
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [-71.491737, -16.461658],
                [-71.484529, -16.464705],
                [-71.481697, -16.465694],
                [-71.476115, -16.467168],
                [-71.47028,  -16.469062],
                [-71.463243, -16.470544],
                [-71.45878,  -16.470709],
                [-71.455863, -16.471532],
                [-71.460411, -16.475979],
                [-71.45715,  -16.481662],
                [-71.457922, -16.482979],
                [-71.466675, -16.481826],
                [-71.470709, -16.48545],
                [-71.476544, -16.485697],
                [-71.485212, -16.485038],
                [-71.490103, -16.485285],
                [-71.491905, -16.487261],
                [-71.498084, -16.487591],
                [-71.502889, -16.488497],
                [-71.506322, -16.488003],
                [-71.50246,  -16.479356],
                [-71.502117, -16.473839],
                [-71.499028, -16.468403],
                [-71.496024, -16.463956],
                [-71.491737, -16.461658]
              ]
            ]
          }
        }
      ]
    };

    // ======================================================
    // INICIALIZAR MAPA
    // ======================================================

    const map = L.map("map").setView([-16.43, -71.52], 11);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution: "© OpenStreetMap contributors"
    }).addTo(map);

    // ======================================================
    // PANEL LATERAL – MOSTRAR DETALLES
    // ======================================================

    const zoneDetailsDiv = document.getElementById("zone-details");

    function showZoneDetails(props) {
      zoneDetailsDiv.innerHTML = `
        <h2>Juzgado de Paz de ${props.zona}</h2>
        <span class="zone-pill">${props.zona}</span>

        <div style="margin-top:12px; text-align:left; line-height:1.5;">
          <p><span class="field-label">Juez de Paz:</span><br>${props.juez_de_paz}</p>

          <p><span class="field-label">Dirección:</span><br>${props.direccion}</p>

          <p><span class="field-label">Horario de atención:</span><br>${props.horario}</p>

          <p><span class="field-label">Teléfono:</span><br>${props.telefono}</p>

          <p><span class="field-label">Correo:</span><br>${props.correo}</p>

          <p><span class="field-label">Cómo llegar:</span><br>
            <a href="${props.mapsUrl}" target="_blank" style="color:#8b4513; font-weight:600;">
              Abrir en Google Maps
            </a>
          </p>
        </div>
      `;
    }

    // ======================================================
    // ICONO ROJO PARA TODOS LOS JUZGADOS
    // ======================================================

    const redIcon = L.icon({
      iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",
      shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    // Guardamos los marcadores por id_zona
    const markersById = {};

    // ======================================================
    // DIBUJAR POLÍGONOS GEOJSON + MARCADORES
    // ======================================================

    const zonasLayer = L.geoJSON(zonasGeoJson, {
      style: function (feature) {
        return {
          color: "#8b4513",      // borde marrón
          weight: 2,
          fillColor: "#d9b48f",  // relleno tierra-crema
          fillOpacity: 0.45
        };
      },
      onEachFeature: function (feature, layer) {
        const props = feature.properties;

        // Crear marcador rojo para esta zona
        if (props.markerLat && props.markerLng) {
          const marker = L.marker([props.markerLat, props.markerLng], { icon: redIcon })
            .addTo(map)
            .bindPopup(`Juzgado de Paz de ${props.zona}`);

          markersById[props.id_zona] = marker;
        }

        // Tooltip con nombre de zona
        layer.bindTooltip(props.zona, { sticky: true });

        // Click → mostrar datos en panel y centrar en el pin correspondiente
        layer.on("click", function () {
          showZoneDetails(props);

          const marker = markersById[props.id_zona];
          if (marker) {
            map.setView([props.markerLat, props.markerLng], 17);
            marker.openPopup();
          } else {
            // fallback: centrar en el polígono
            map.fitBounds(layer.getBounds());
          }
        });
      }
    }).addTo(map);

    // Centrar el mapa para que todas las zonas se vean
    map.fitBounds(zonasLayer.getBounds());
  </script>
</body>
</html>
